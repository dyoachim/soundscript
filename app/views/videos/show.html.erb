
<div class='videoShowContainer'>
	<div class='video_box'>
		<div id="ytapiplayer">
	  	You need Flash player 8+ and JavaScript enabled to view this video.
		</div>
	</div>
	<div class='controls_box'>
		<span class='video_id' id='<%= @video.id %>'></span>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>    

		<script type="text/javascript">
      var videoPlayer = new VideoPlayer('<%= @video.id %>', <%= current_user.present? %>)
			var params = { allowScriptAccess: "always" };
			var atts = { id: "myytplayer" };
			
			swfobject.embedSWF("http://www.youtube.com/v/<%= @video.id%>?enablejsapi=1&playerapiid=ytplayer&version=3",
		    "ytapiplayer", "640", "321", "8", null, null, params, atts);

		  function onYouTubePlayerReady(playerId) {
		    ytplayer = document.getElementById("myytplayer");
		    <% if @tracks.any? %> 
		    	buildTracks(ytplayer.getDuration());
		    <% else %>
		    	videoPlayer.fillTracks(ytplayer.getDuration());
		    <% end %>
		    setInterval(videoPlayer.updatePlayerInfo.bind(videoPlayer), 250);
		  }


		  function buildTracks(duration) {
			  <% @tracks.each do |trackBuild| %>
					var script = <%= eval(trackBuild.transcript).to_json.html_safe %>
	    		var size = 0, key;
					
			  	var track = "<div class='language_box'>English</div>"
	    		track += "<div class='show_tracks_box' style='width:"+ duration * 10 + "em;'>"
	    		track += "<div class='progressBar'></div>"
    		
	    		for (key in script) { if (script.hasOwnProperty(key)) {size++;}}    			
					for(var i = 0; i < size; i++) {	
						track += ['<div class="track_post-it" style="' + script[i]['position_css'] + '">',
	            '<section class="content" contenteditable="true">' + script[i]['content'] + '</section>',
	          '</div>'].join('\n');
					}
					
					track += "</div>";
					$('.track_divs').append(track);
				<% end %>
			}
			
			
		</script>
		<ul>
			<a href="javascript:ytplayer.pauseVideo()"><li id="pause"></li></a>
			<a href="javascript:ytplayer.playVideo()"><li id="play"></li></a>
			<a href="javascript:ytplayer.seekTo(0)"><li id="replay"></li></a>
			<a href="javascript:ytplayer.seekTo(ytplayer.getCurrentTime() - 5)"><li id="rewind"></li></a>
			<br>
			<li style="font-family: 'Quicksand', sans-serif;"><span id="currentTime">--:--</span> / <span id='totalDuration'></span></li>
		</ul>
		<%if current_user%>
			<div id="button_add_track">
				<button class="appendTrack">Add Track</button>
			</div>	
		<%end%>
	</div>
	<div class='clearfix'></div>
	<div class="track_divs"></div>
</div>
